#!/usr/bin/env ruby
# encoding: UTF-8

# dead simple ssh connection manager
class Application
  require 'highline/import'
  require 'ssh-bookmarks'

  # CLI interface for SSH manager
  class Interface < Foundation
    def initialize
      config = Config.new
      show_menu config.data, 'host'

      # ignore errors when use ctrl-c or ctrl-d
    rescue SystemExit, Interrupt, EOFError
      puts "\nexiting..."
    end

    # Show menu
    # @param list [Array] list of all parameters of  hosts
    # @param title [String] which parameter will be a title of item of menu
    def show_menu(list, title)
      t = title.to_sym
      proposal = 'Please choose the server which you would like to connect?'
      choose do |menu|
        menu.prompt = proposal
        list.each do |item|
          unless item[:options][:hidden]
            menu.choice(item[t]) { SSH.connect item[t] }
          end
        end
      end
    end
  end
  # Initialize interface
  Interface.new
end
